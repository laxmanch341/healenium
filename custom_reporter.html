<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healenium Healing Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <style>
        :root {
            --primary-color: #4e73df;
            --success-color: #1cc88a;
            --danger-color: #e74a3b;
            --warning-color: #f6c23e;
            --light-color: #f8f9fc;
            --dark-color: #5a5c69;
        }
        
        body {
            background-color: #f8f9fc;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .card {
            border-radius: 0.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
            border: none;
        }
        
        .card-header {
            padding: 0.75rem 1.25rem;
            background-color: #fff;
            border-bottom: 1px solid #e3e6f0;
            font-weight: 700;
        }
        
        .summary-card {
            border-left: 0.25rem solid;
        }
        
        .summary-card.total {
            border-left-color: var(--primary-color);
        }
        
        .summary-card.healed {
            border-left-color: var(--success-color);
        }
        
        .summary-card.failed {
            border-left-color: var(--danger-color);
        }
        
        .summary-card.rate {
            border-left-color: var(--warning-color);
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .status-badge {
            padding: 0.35em 0.65em;
            border-radius: 0.25rem;
            font-weight: 600;
        }
        
        .status-success {
            background-color: rgba(28, 200, 138, 0.2);
            color: var(--success-color);
        }
        
        .status-failed {
            background-color: rgba(231, 74, 59, 0.2);
            color: var(--danger-color);
        }
        
        .confidence-bar {
            height: 8px;
            background-color: #eaecf4;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .confidence-high {
            background-color: var(--success-color);
        }
        
        .confidence-medium {
            background-color: var(--warning-color);
        }
        
        .confidence-low {
            background-color: var(--danger-color);
        }
        
        .data-table {
            font-size: 0.9rem;
        }
        
        .data-table th {
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .original-locator, .healed-locator {
            font-family: monospace;
            font-size: 0.85em;
            word-break: break-all;
        }
        
        .filters {
            background-color: #fff;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
        }
        
        .report-title {
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 0.5rem;
        }
        
        .last-updated {
            font-size: 0.9rem;
            color: #858796;
        }
    </style>
</head>
<body>
    <div class="container-fluid px-4 mt-4">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="report-title">Healenium Healing Report</h1>
                <div class="last-updated">Generated on <span id="current-date"></span></div>
            </div>
            <div class="text-end">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjNGU3M2RmIj48cGF0aCBkPSJNMTIgMkM2LjQ4NiAyIDIgNi40ODYgMiAxMnM0LjQ4NiAxMCAxMCAxMCAxMC00LjQ4NiAxMC0xMFMxNy41MTQgMiAxMiAyeiIgb3BhY2l0eT0iLjMiLz48cGF0aCBkPSJNMTIgMkM2LjQ4NiAyIDIgNi40ODYgMiAxMnM0LjQ4NiAxMCAxMCAxMCAxMC00LjQ4NiAxMC0xMFMxNy41MTQgMiAxMiAyeiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNGU3M2RmIiBzdHJva2Utd2lkdGg9IjIiLz48cGF0aCBkPSJNMTIgNnY2bDQgMiIgc3Ryb2tlPSIjNGU3M2RmIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==" alt="Logo">
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="row">
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card total">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Broken Locators</div>
                        <div class="summary-value" id="total-tests">0</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card healed">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Healed</div>
                        <div class="summary-value" id="healed-count">0</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card failed">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Failed</div>
                        <div class="summary-value" id="failed-count">0</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-md-6 mb-4">
                <div class="card summary-card rate">
                    <div class="card-body">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Success Rate</div>
                        <div class="summary-value" id="success-rate">0%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="row">
            <!-- Pie Chart -->
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">Healing Status Distribution</div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="pie-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bar Chart -->
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-header">Healed Locators per Test Case</div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="bar-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Line Chart -->
        <div class="row">
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-header">Healing Activity Over Time</div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="line-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filters">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="test-filter" class="form-label">Filter by Test Case</label>
                    <select class="form-select" id="test-filter">
                        <option value="">All Tests</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="status-filter" class="form-label">Filter by Healing Status</label>
                    <select class="form-select" id="status-filter">
                        <option value="">All Statuses</option>
                        <option value="success">Success</option>
                        <option value="failed">Failed</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Data Table -->
        <div class="card mb-4">
            <div class="card-header">Healing Details</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped data-table" id="healing-table">
                        <thead>
                            <tr>
                                <th>Test Case Name</th>
                                <th>Original Locator</th>
                                <th>Healed Locator</th>
                                <th>Healing Confidence</th>
                                <th>Healing Status</th>
                                <th>Timestamp</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data - this would be replaced with your actual data

        
        // Set current date
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Calculate summary statistics
        function calculateSummary(data) {
            const total = data.length;
            const healed = data.filter(item => item.status === 'success').length;
            const failed = total - healed;
            const successRate = total > 0 ? Math.round((healed / total) * 100) : 0;
            
            return { total, healed, failed, successRate };
        }
        
        // Update summary cards
        function updateSummary(summary) {
            document.getElementById('total-tests').textContent = summary.total;
            document.getElementById('healed-count').textContent = summary.healed;
            document.getElementById('failed-count').textContent = summary.failed;
            document.getElementById('success-rate').textContent = `${summary.successRate}%`;
        }
        
        // Render pie chart
        function renderPieChart(data) {
            const ctx = document.getElementById('pie-chart').getContext('2d');
            const summary = calculateSummary(data);
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Healed', 'Failed to Heal'],
                    datasets: [{
                        data: [summary.healed, summary.failed],
                        backgroundColor: ['#1cc88a', '#e74a3b'],
                        hoverBackgroundColor: ['#17a673', '#be2617'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Render bar chart
        function renderBarChart(data) {
            const ctx = document.getElementById('bar-chart').getContext('2d');
            
            // Group data by test case
            const testCaseMap = new Map();
            data.forEach(item => {
                if (!testCaseMap.has(item.testName)) {
                    testCaseMap.set(item.testName, { healed: 0, total: 0 });
                }
                const stats = testCaseMap.get(item.testName);
                stats.total++;
                if (item.status === 'success') {
                    stats.healed++;
                }
            });
            
            const testCases = Array.from(testCaseMap.keys());
            const healedCounts = testCases.map(test => testCaseMap.get(test).healed);
            const totalCounts = testCases.map(test => testCaseMap.get(test).total);
            
            // Shorten test names for display
            const shortenedTestCases = testCases.map(name => {
                if (name.length > 25) {
                    return name.substring(0, 22) + '...';
                }
                return name;
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: shortenedTestCases,
                    datasets: [{
                        label: 'Healed Locators',
                        data: healedCounts,
                        backgroundColor: '#4e73df',
                        borderColor: '#2e59d9',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            },
                            title: {
                                display: true,
                                text: 'Number of Healed Locators'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Test Cases'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const testName = testCases[context.dataIndex];
                                    const stats = testCaseMap.get(testName);
                                    return `Total: ${stats.total}\nSuccess Rate: ${Math.round((stats.healed / stats.total) * 100)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Render line chart
        function renderLineChart(data) {
            const ctx = document.getElementById('line-chart').getContext('2d');
            
            // Group data by day
            const dailyMap = new Map();
            data.forEach(item => {
                const date = item.timestamp.split('T')[0]; // Extract YYYY-MM-DD
                if (!dailyMap.has(date)) {
                    dailyMap.set(date, { success: 0, failed: 0 });
                }
                
                if (item.status === 'success') {
                    dailyMap.get(date).success++;
                } else {
                    dailyMap.get(date).failed++;
                }
            });
            
            // Sort dates
            const dates = Array.from(dailyMap.keys()).sort();
            const successData = dates.map(date => dailyMap.get(date).success);
            const failedData = dates.map(date => dailyMap.get(date).failed);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Healed',
                            data: successData,
                            backgroundColor: 'rgba(28, 200, 138, 0.1)',
                            borderColor: '#1cc88a',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Failed to Heal',
                            data: failedData,
                            backgroundColor: 'rgba(231, 74, 59, 0.1)',
                            borderColor: '#e74a3b',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            },
                            title: {
                                display: true,
                                text: 'Number of Healing Events'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
        }
        
        // Populate table
        function populateTable(data) {
            const tableBody = document.querySelector('#healing-table tbody');
            tableBody.innerHTML = '';
            
            // Populate test filter dropdown
            const testFilter = document.getElementById('test-filter');
            const uniqueTests = [...new Set(data.map(item => item.testName))];
            uniqueTests.forEach(test => {
                const option = document.createElement('option');
                option.value = test;
                option.textContent = test;
                testFilter.appendChild(option);
            });
            
            // Add data to table
            data.forEach(item => {
                const row = document.createElement('tr');
                
                // Confidence visualization
                let confidenceHtml = '';
                if (item.status === 'success') {
                    const confidenceClass = item.confidence >= 0.9 ? 'confidence-high' : 
                                           item.confidence >= 0.7 ? 'confidence-medium' : 'confidence-low';
                    
                    confidenceHtml = `
                        <div class="d-flex align-items-center">
                            <div class="me-2">${Math.round(item.confidence * 100)}%</div>
                            <div class="confidence-bar" style="width: 100px">
                                <div class="confidence-fill ${confidenceClass}" 
                                     style="width: ${item.confidence * 100}%"></div>
                            </div>
                        </div>
                    `;
                } else {
                    confidenceHtml = '<div class="text-muted">N/A</div>';
                }
                
                // Format timestamp
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                const formattedTime = date.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                row.innerHTML = `
                    <td>${item.testName}</td>
                    <td><div class="original-locator">${item.original}</div></td>
                    <td>
                        ${item.healed ? `<div class="healed-locator">${item.healed}</div>` : '<span class="text-muted">Not healed</span>'}
                    </td>
                    <td>${confidenceHtml}</td>
                    <td>
                        <span class="status-badge status-${item.status}">
                            ${item.status === 'success' ? 'Success' : 'Failed'}
                        </span>
                    </td>
                    <td>
                        <div>${formattedDate}</div>
                        <div class="text-muted">${formattedTime}</div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Filter table
        function setupFilters() {
            const testFilter = document.getElementById('test-filter');
            const statusFilter = document.getElementById('status-filter');
            const tableRows = document.querySelectorAll('#healing-table tbody tr');
            
            function applyFilters() {
                const selectedTest = testFilter.value;
                const selectedStatus = statusFilter.value;
                
                tableRows.forEach(row => {
                    const testName = row.cells[0].textContent;
                    const status = row.cells[4].textContent.trim().toLowerCase();
                    
                    const testMatch = !selectedTest || testName === selectedTest;
                    const statusMatch = !selectedStatus || status === selectedStatus;
                    
                    row.style.display = (testMatch && statusMatch) ? '' : 'none';
                });
            }
            
            testFilter.addEventListener('change', applyFilters);
            statusFilter.addEventListener('change', applyFilters);
        }
        
        // Initialize report
        async function initReport() {
        const response = await fetch('healing.json');
            const healingData = await response.json();
            const summary = calculateSummary(healingData);
            updateSummary(summary);
            renderPieChart(healingData);
            renderBarChart(healingData);
            renderLineChart(healingData);
            populateTable(healingData);
            setupFilters();
        }
        
        // Start the report when the page loads
        window.addEventListener('DOMContentLoaded', initReport);
    </script>
</body>
</html>